# üçï Case Study #2 Pizza Runner

## Solution - B. Runner and Customer Experience

### 1. How many runners signed up for each 1 week period? (i.e. week starts 2021-01-01)
```sql
SELECT CAST(to_char(registration_date, 'WW')as NUMERIC)as week_period,
	COUNT(runner_id)as number_signup
FROM runners		
GROUP BY 1
ORDER BY 1;
```
### Answer :
- On Week 1 of Jan 2021, 2 new runners signed up.
- On Week 2 and 3 of Jan 2021, 1 new runner signed up.
----

## 2. What was the average time in minutes it took for each runner to arrive at the Pizza Runner HQ to pickup the order?
```sql
SELECT runner_id,
		ROUND(CAST(AVG(
				( DATE_PART('hour', pickup_time - order_time)*60 + DATE_PART('minute', pickup_time - order_time) )*60 +
					DATE_PART('second', pickup_time - order_time)
			)AS NUMERIC
				),2)as average_delivery_time
FROM join_table
GROUP BY 1
ORDER BY 1;
```

## 3. Is there any relationship between the number of pizzas and how long the order takes to prepare?
```sql
SELECT number_pizza,
		ROUND(AVG(average_delivery_time),2)as duration_prepare
FROM(	
	SELECT order_id,
			COUNT(pizza_id)as number_pizza,
			ROUND(CAST(AVG(
					( DATE_PART('hour', pickup_time - order_time)*60 + DATE_PART('minute', pickup_time - order_time) )*60 +
						DATE_PART('second', pickup_time - order_time)
				)AS NUMERIC
					),2)as average_delivery_time
	FROM join_table
	GROUP BY 1
	ORDER BY 1)as average_prepare
GROUP BY 1
ORDER BY 1;
```


## 4. What was the average distance travelled for each customer?
```sql
SELECT customer_id,
		ROUND(AVG(distance),2)as average_distance_travelled
FROM join_table
GROUP BY 1
ORDER BY 1;
```


## 5. What was the difference between the longest and shortest delivery times for all orders?
```sql
SELECT max_duration - min_duration as difference
FROM (
SELECT 
		MAX(duration)as max_duration,
		MIN(duration)as min_duration
FROM join_table)as temp_table	
```


## 6. What was the average speed for each runner for each delivery and do you notice any trend for these values?
```sql
SELECT runner_id,
		order_id,
		ROUND(AVG(distance::numeric / (duration::numeric/60)),2)as average_speed
FROM join_table
GROUP BY 1,2
ORDER BY 1,2
```

## 7. What is the successful delivery percentage for each runner?
```sql
SELECT runner_id,
		round(SUM(successful_order::numeric)*100 / COUNT(successful_order::numeric),2) as percentage
FROM(		
	select runner_id,
			order_id,
			cancellation,
			case when cancellation IS NULL then 1 ELSE 0 END as successful_order
	from join_table
	GROUP BY
        runner_id,
        order_id,
        cancellation
      ORDER BY
        runner_id, order_id)AS a
GROUP BY 1
ORDER BY 1;
```


